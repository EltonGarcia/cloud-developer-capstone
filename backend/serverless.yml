service:
  name: notes-app


plugins:
  - serverless-webpack
  - serverless-iam-roles-per-function
  - serverless-reqvalidator-plugin
  - serverless-aws-documentation

package:
  individually: true

provider:
  name: aws
  runtime: nodejs12.x

  stage: ${opt:stage, 'dev'}
  region: ${opt:region, 'us-east-1'}

  tracing:
    lambda: true
    apiGateway: true

  environment:
    NOTES_TABLE: Notes-${self:provider.stage}
    NOTES_INDEX: NotesIndex
    IMAGES_TABLE: Notes-Images-${self:provider.stage}
    IMAGE_ID_INDEX: ImageIdIndex
    IMAGES_S3_BUCKET: notes-bucket-capstone-proj-${self:provider.stage}
    SIGNED_URL_EXPIRATION: 300
    AUTH_0_SECRET_ID: Auth0Secret-${self:provider.stage}
    AUTH_0_SECRET_FIELD: auth0Secret

  iamRoleStatements:
    - Effect: Allow
      Action:
        - xray:PutTraceSegments
        - xray:PutTelemetryRecords
      Resource:
        - "*"

custom:
  serverless-iam-roles-per-function:
    defaultInherit: true

  documentation:
    api:
      info:
        version: v1.0.0
        title: Notes API
        description: Notes API Project Capstone
    models:
      - name: CreateNoteValidation
        contentType: application/json
        schema: ${file(src/requests/validations/create-note-request.json)}
      - name: UpdateNoteValidation
        contentType: application/json
        schema: ${file(src/requests/validations/update-note-request.json)}